From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jaime Gonzalez <jaime.gonzalez@appentra.com>
Date: Wed, 19 Mar 2025 15:49:09 +0100
Subject: Add semantic accessors

---
 grammar.js                   | 27 ++++++++++++++++++++-------
 test/corpus/constructs.txt   |  6 +++---
 test/corpus/expressions.txt  |  6 +++---
 test/corpus/preprocessor.txt |  8 ++++----
 test/corpus/regressions.txt  |  2 +-
 test/corpus/statements.txt   | 10 +++++-----
 6 files changed, 36 insertions(+), 23 deletions(-)

diff --git a/grammar.js b/grammar.js
index 4e6a7f1..d0af7b9 100644
--- a/grammar.js
+++ b/grammar.js
@@ -302,7 +302,11 @@ module.exports = grammar({
       $.end_program_statement
     ),
 
-    program_statement: $ => seq(caseInsensitive('program'), $._name, $._end_of_statement),
+    program_statement: $ => seq(
+      caseInsensitive('program'),
+      field('name', $._name),
+      $._end_of_statement
+    ),
     end_program_statement: $ => blockStructureEnding($, 'program'),
 
     module: $ => seq(
@@ -318,7 +322,11 @@ module.exports = grammar({
       $.end_module_statement
     ),
 
-    module_statement: $ => seq(caseInsensitive('module'), $._name, $._end_of_statement),
+    module_statement: $ => seq(
+      caseInsensitive('module'),
+      field('name', $._name),
+      $._end_of_statement
+    ),
     end_module_statement: $ => blockStructureEnding($, 'module'),
 
     submodule: $ => seq(
@@ -342,7 +350,7 @@ module.exports = grammar({
         ':', field('parent', $.module_name)
       )),
       ')',
-      $._name,
+      field('name', $._name),
       $._end_of_statement,
     ),
     end_submodule_statement: $ => blockStructureEnding($, 'submodule'),
@@ -374,7 +382,7 @@ module.exports = grammar({
     interface_statement: $ => seq(
       optional($.abstract_specifier),
       caseInsensitive('interface'),
-      optional(choice($._name, $._generic_procedure)),
+      optional(choice(field('name', $._name), $._generic_procedure)),
       $._end_of_statement,
     ),
 
@@ -768,8 +776,13 @@ module.exports = grammar({
       optional($.statement_label),
       caseInsensitive('type'),
       choice(
-        seq(optional('::'), $._type_name),
-        seq(',', commaSep1($._derived_type_qualifier), '::', $._type_name)
+        seq(optional('::'), field('name', $._type_name)),
+        seq(
+          ',',
+          commaSep1($._derived_type_qualifier),
+          '::',
+          field('name', $._type_name)
+        )
       ),
       optional(alias($.argument_list, $.derived_type_parameter_list)),
       $._end_of_statement,
@@ -2048,7 +2061,7 @@ module.exports = grammar({
     // precedence is used to prevent conflict with assignment expression
     keyword_argument: $ => prec(1, seq(
       field("name",$.identifier),
-      '=',
+      field("equal", '='),
       field("value",choice($._expression, $.assumed_size, $.assumed_shape))
     )),
 
diff --git a/test/corpus/constructs.txt b/test/corpus/constructs.txt
index ab165f0..9b2eccb 100644
--- a/test/corpus/constructs.txt
+++ b/test/corpus/constructs.txt
@@ -988,12 +988,12 @@ end program
 (translation_unit
   (program
     (program_statement
-      (name))
+      name: (name))
     (derived_type_definition
       (derived_type_statement
         access: (access_specifier)
         (abstract_specifier)
-        (type_name))
+        name: (type_name))
       (end_type_statement
         (name)))
     (derived_type_definition
@@ -1001,7 +1001,7 @@ end program
         access: (access_specifier)
         base: (base_type_specifier
           (identifier))
-        (type_name))
+        name: (type_name))
       (end_type_statement
         (name)))
     (end_program_statement)))
diff --git a/test/corpus/expressions.txt b/test/corpus/expressions.txt
index c5a8f3d..eb8b11c 100644
--- a/test/corpus/expressions.txt
+++ b/test/corpus/expressions.txt
@@ -159,7 +159,7 @@ END PROGRAM
 (translation_unit
   (program
     (program_statement
-      (name))
+      name: (name))
     (assignment_statement
       left: (identifier)
       right: (string_literal))
@@ -242,7 +242,7 @@ end program
 (translation_unit
   (program
     (program_statement
-      (name))
+      name: (name))
     (variable_declaration
       type: (intrinsic_type)
       declarator: (init_declarator
@@ -717,7 +717,7 @@ END PROGRAM
 (translation_unit
   (program
     (program_statement
-      (name))
+      name: (name))
     (assignment_statement
       left: (identifier)
       right: (call_expression
diff --git a/test/corpus/preprocessor.txt b/test/corpus/preprocessor.txt
index 4fe227d..29175d5 100644
--- a/test/corpus/preprocessor.txt
+++ b/test/corpus/preprocessor.txt
@@ -434,7 +434,7 @@ end program
 (translation_unit
   (program
     (program_statement
-      (name))
+      name: (name))
     (use_statement
       (module_name)
       (included_items
@@ -522,7 +522,7 @@ end module foo
 (translation_unit
   (module
     (module_statement
-      (name))
+      name: (name))
     (internal_procedures
       (contains_statement)
       (subroutine
@@ -572,7 +572,7 @@ end module foo
 (translation_unit
   (module
     (module_statement
-      (name))
+      name: (name))
     (internal_procedures
       (contains_statement)
       (subroutine
@@ -632,7 +632,7 @@ end module foo
 (translation_unit
   (module
     (module_statement
-      (name))
+      name: (name))
     (internal_procedures
       (contains_statement)
       (subroutine
diff --git a/test/corpus/regressions.txt b/test/corpus/regressions.txt
index fc47bf1..1af946a 100644
--- a/test/corpus/regressions.txt
+++ b/test/corpus/regressions.txt
@@ -168,7 +168,7 @@ end program
 (translation_unit
   (program
     (program_statement
-      (name))
+      name: (name))
     (assignment_statement
       left: (call_expression
         (identifier)
diff --git a/test/corpus/statements.txt b/test/corpus/statements.txt
index ca8c86e..d6bebae 100644
--- a/test/corpus/statements.txt
+++ b/test/corpus/statements.txt
@@ -289,7 +289,7 @@ END PROGRAM
 (translation_unit
   (program
     (program_statement
-      (name))
+      name: (name))
     (variable_declaration
       type: (intrinsic_type)
       attribute: (type_qualifier)
@@ -799,7 +799,7 @@ END PROGRAM TEST
 (translation_unit
   (program
     (program_statement
-      (name))
+      name: (name))
     (variable_declaration
       type: (intrinsic_type)
       attribute: (type_qualifier
@@ -1961,7 +1961,7 @@ END PROGRAM test
 (translation_unit
   (program
     (program_statement
-      (name))
+      name: (name))
     (enum
       (enum_statement
         (language_binding
@@ -2711,7 +2711,7 @@ end program test
 (translation_unit
   (program
     (program_statement
-      (name))
+      name: (name))
     (allocate_statement
       allocation: (sized_allocation
         (identifier)
@@ -3499,7 +3499,7 @@ end program
 (translation_unit
   (program
     (program_statement
-      (name))
+      name: (name))
     (implicit_statement
       (none))
     (variable_declaration
