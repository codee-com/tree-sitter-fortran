From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?I=C3=B1aki=20Amatria=20Barral?= <inaki.amatria@appentra.com>
Date: Wed, 25 Jun 2025 12:35:41 +0200
Subject: Parse inline preprocessor comments

---
 grammar.js                   |  2 +-
 test/corpus/preprocessor.txt | 15 +++++++++++++++
 2 files changed, 16 insertions(+), 1 deletion(-)

diff --git a/grammar.js b/grammar.js
index f685c64..80bc23a 100644
--- a/grammar.js
+++ b/grammar.js
@@ -247,7 +247,7 @@ module.exports = grammar({
       ')',
     ),
 
-    preproc_comment: $ => /\/\*.*\*\//,
+    preproc_comment: $ => choice(/\/\*.*\*\//, /\/\/.*/),
 
     preproc_binary_expression: $ => {
       const table = [
diff --git a/test/corpus/preprocessor.txt b/test/corpus/preprocessor.txt
index 700d955..02c61bb 100644
--- a/test/corpus/preprocessor.txt
+++ b/test/corpus/preprocessor.txt
@@ -126,6 +126,11 @@ end subroutine foo3
 #define c 16
 #endif  /* DEFINE1 */
 
+#ifdef DEFINE4
+subroutine foo4
+end subroutine foo4
+#endif // DEFINE4
+
 --------------------------------------------------------------------------------
 
 (translation_unit
@@ -164,6 +169,16 @@ end subroutine foo3
         content: (preproc_def
           name: (identifier)
           value: (preproc_arg))))
+    (preproc_comment))
+  (preproc_ifdef
+    name: (identifier)
+    content: (subroutine
+      (subroutine_statement
+        name: (name)
+        (end_of_statement))
+      (end_subroutine_statement
+        (name)
+        (end_of_statement)))
     (preproc_comment)))
 
 ================================================================================
